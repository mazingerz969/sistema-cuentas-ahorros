<!-- Componente de gesti√≥n de transacciones -->
<div class="transacciones-container">
  
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>Gesti√≥n de Transacciones</h1>
      <p>Realiza dep√≥sitos, retiros y consulta tu historial</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="cambiarTipoTransaccion(TipoTransaccion.DEPOSITO); mostrandoFormularioNueva = true">
        <span class="icon">‚ûï</span>
        Depositar
      </button>
      <button class="btn-secondary" (click)="cambiarTipoTransaccion(TipoTransaccion.RETIRO); mostrandoFormularioNueva = true">
        <span class="icon">‚ûñ</span>
        Retirar
      </button>
    </div>
  </div>

  <!-- Mensajes de estado -->
  <div class="messages">
    <div class="error-message" *ngIf="error">
      <span class="icon">‚ö†Ô∏è</span>
      {{ error }}
      <button class="btn-close" (click)="error = ''">√ó</button>
    </div>
    
    <div class="success-message" *ngIf="mensajeExito">
      <span class="icon">‚úÖ</span>
      {{ mensajeExito }}
      <button class="btn-close" (click)="mensajeExito = ''">√ó</button>
    </div>
  </div>

  <!-- Estad√≠sticas r√°pidas -->
  <div class="stats-section" *ngIf="transaccionesFiltradas.length > 0">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon deposito">üí∞</div>
        <div class="stat-content">
          <h3>Total Dep√≥sitos</h3>
          <p class="stat-value">{{ formatearMoneda(totalDepositos.toString()) }}</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon retiro">üí∏</div>
        <div class="stat-content">
          <h3>Total Retiros</h3>
          <p class="stat-value">{{ formatearMoneda(totalRetiros.toString()) }}</p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon balance">‚öñÔ∏è</div>
        <div class="stat-content">
          <h3>Balance Neto</h3>
          <p class="stat-value" [class]="balanceNeto >= 0 ? 'positive' : 'negative'">
            {{ balanceNeto >= 0 ? '+' : '' }}{{ formatearMoneda(balanceNeto.toString()) }}
          </p>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon total">üìä</div>
        <div class="stat-content">
          <h3>Total Transacciones</h3>
          <p class="stat-value">{{ transaccionesFiltradas.length }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros y b√∫squeda -->
  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="terminoBusqueda" 
        (input)="onBusquedaChange()"
        placeholder="Buscar por cuenta, descripci√≥n o tipo..."
        class="search-input"
      >
      <span class="search-icon">üîç</span>
    </div>
    
    <div class="filter-options">
      <select [(ngModel)]="filtroCuenta" (change)="onFiltrosChange()" class="filter-select">
        <option value="">Todas las cuentas</option>
        <option *ngFor="let cuenta of cuentas" [value]="cuenta.id">
          {{ cuenta.numeroCuenta }} - {{ cuenta.titular }}
        </option>
      </select>
      
      <select [(ngModel)]="filtroTipo" (change)="onFiltrosChange()" class="filter-select">
        <option value="">Todos los tipos</option>
        <option value="DEPOSITO">Dep√≥sitos</option>
        <option value="RETIRO">Retiros</option>
      </select>
    </div>
  </div>

  <!-- Estado de carga -->
  <div class="loading-state" *ngIf="cargando">
    <div class="spinner"></div>
    <p>Cargando transacciones...</p>
  </div>

  <!-- Lista de transacciones -->
  <div class="transactions-list" *ngIf="!cargando && transaccionesFiltradas.length > 0">
    <div class="transaction-item" *ngFor="let transaccion of transaccionesFiltradas">
      <div class="transaction-icon" [class]="getClaseTransaccion(transaccion.tipo)">
        {{ getIconoTransaccion(transaccion.tipo) }}
      </div>
      
      <div class="transaction-details">
        <div class="transaction-header">
          <h4>{{ transaccion.tipoDescripcion }}</h4>
          <span class="amount" [class]="getClaseTransaccion(transaccion.tipo)">
            {{ transaccion.tipo === 'DEPOSITO' ? '+' : '-' }}{{ formatearMoneda(transaccion.monto) }}
          </span>
        </div>
        
        <div class="transaction-meta">
          <p class="account">{{ transaccion.numeroCuenta }}</p>
          <p class="date">{{ formatearFecha(transaccion.fechaTransaccion) }}</p>
          <p class="description" *ngIf="transaccion.descripcion">{{ transaccion.descripcion }}</p>
          <p class="saldo-resultante">Saldo: {{ formatearMoneda(transaccion.saldoResultante) }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Estado vac√≠o -->
  <div class="empty-state" *ngIf="!cargando && transaccionesFiltradas.length === 0">
    <div class="empty-icon">üìã</div>
    <h3>No se encontraron transacciones</h3>
    <p *ngIf="terminoBusqueda || filtroCuenta || filtroTipo">
      Intenta ajustar los filtros de b√∫squeda
    </p>
    <p *ngIf="!terminoBusqueda && !filtroCuenta && !filtroTipo">
      Realiza tu primera transacci√≥n
    </p>
    <div class="empty-actions" *ngIf="!terminoBusqueda && !filtroCuenta && !filtroTipo">
      <button class="btn-primary" (click)="cambiarTipoTransaccion(TipoTransaccion.DEPOSITO); mostrandoFormularioNueva = true">
        <span class="icon">‚ûï</span>
        Realizar dep√≥sito
      </button>
    </div>
  </div>

  <!-- Modal para nueva transacci√≥n -->
  <div class="modal-overlay" *ngIf="mostrandoFormularioNueva" (click)="mostrandoFormularioNueva = false">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ tipoTransaccionSeleccionada === TipoTransaccion.DEPOSITO ? 'Realizar Dep√≥sito' : 'Realizar Retiro' }}</h2>
        <button class="btn-close" (click)="mostrandoFormularioNueva = false">√ó</button>
      </div>
      
      <form (ngSubmit)="realizarTransaccion()" class="modal-form">
        <div class="form-group">
          <label for="cuentaId">Cuenta *</label>
          <select 
            id="cuentaId"
            [(ngModel)]="nuevaTransaccion.cuentaId" 
            name="cuentaId"
            required
            class="form-select"
          >
            <option value="">Selecciona una cuenta</option>
            <option *ngFor="let cuenta of opcionesCuentas" [value]="cuenta.id">
              {{ cuenta.numeroCuenta }} - {{ cuenta.titular }} ({{ formatearMoneda(cuenta.saldo) }})
            </option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="monto">Monto *</label>
          <input 
            type="number" 
            id="monto"
            [(ngModel)]="nuevaTransaccion.monto" 
            name="monto"
            placeholder="0.00"
            min="0.01"
            step="0.01"
            required
            class="form-input"
          >
        </div>
        
        <div class="form-group">
          <label for="descripcion">Descripci√≥n</label>
          <textarea 
            id="descripcion"
            [(ngModel)]="nuevaTransaccion.descripcion" 
            name="descripcion"
            placeholder="Descripci√≥n de la transacci√≥n (opcional)"
            rows="3"
            class="form-textarea"
          ></textarea>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="mostrandoFormularioNueva = false">
            Cancelar
          </button>
          <button type="submit" class="btn-primary" [disabled]="guardando">
            <span class="icon" *ngIf="!guardando">{{ tipoTransaccionSeleccionada === TipoTransaccion.DEPOSITO ? 'üí∞' : 'üí∏' }}</span>
            <span class="spinner" *ngIf="guardando"></span>
            {{ guardando ? 'Procesando...' : (tipoTransaccionSeleccionada === TipoTransaccion.DEPOSITO ? 'Depositar' : 'Retirar') }}
          </button>
        </div>
      </form>
    </div>
  </div>

</div> 